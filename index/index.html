<!doctype html>
<html lang="tr">
<meta charset="utf-8">
<title>Excel → PDF</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<body style="font-family:system-ui;max-width:720px;margin:40px auto;padding:0 12px">
  <h1>Excel Yükle → Gelir Tablosu PDF İndir</h1>
  <input id="f" type="file" accept=".xlsx,.xls,.csv">
  <button id="b">İşle ve PDF İndir</button>
  <div id="s" style="margin-top:10px;color:#666"></div>

<script>
const s = document.getElementById('s'); // tatus yazılacak <div id="s"> elemanını yakalıyoruz
document.getElementById('b').onclick = async () => { //<button id="b"> tıklanınca çalışacak handler
  const file = document.getElementById('f').files[0]; //type="file"> içinden ilk seçilen dosya
  // ... (sonrasında FormData oluşturup /api/process'e POST ediyoruz)
  if (!file) { s.textContent = 'Dosya seçin.'; return; }
  const fd = new FormData(); fd.append('file', file); // dosyayı seçip gönderiyoruz
  s.textContent = 'İşleniyor…';
  try {
    const res = await fetch('/api/process', { method: 'POST', body: fd });
    if (!res.ok || !res.headers.get('content-type')?.includes('application/pdf')) { //PDF olup olmadığını kontrol
      const t = await res.text();
      s.textContent = 'Hata: ' + res.status + ' ' + t;
      return;
    }
    const blob = await res.blob(); // geleni binary al
    const url = URL.createObjectURL(blob); // geçici link oluştur
    const a = document.createElement('a'); a.href = url; a.download = 'gelir-tablosu.pdf'; a.click();  // görünmez <a> oluştur
    URL.revokeObjectURL(url); // geçici linki çöpe at (belleği temizle)
    s.textContent = 'PDF indirildi.';
  } catch (e) {
    s.textContent = 'İstek hatası: ' + e;
  }
};
</script>
</body>
</html>
